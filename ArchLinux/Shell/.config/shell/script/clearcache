#!/bin/sh
set -eu

# Clear package manager caches
yay -Scc
printf "\033[1;36m%s\033[0m\n" "Package manager caches cleared"

# Clear language/tool caches
cargo cache -e
printf "\033[1;36m%s\033[0m\n" "Cargo caches cleared"
npm cache clean --force
printf "\033[1;36m%s\033[0m\n" "NPM caches cleared"
go clean -cache -modcache -testcache -fuzzcache
printf "\033[1;36m%s\033[0m\n" "Go caches cleared"

# Clear python package's cache
[ -d "$HOME/.cache/pip" ] && rm -rf -- "${HOME:?}/.cache/pip/"*
printf "\033[1;36m%s\033[0m\n" "Python package download cache cleared"

# Clear Arduino CLI download staging cache
arduino-cli cache clean
printf "\033[1;36m%s\033[0m\n" "Arduino download staging cache cleared"

# Refresh shell command hash (harmless in non-interactive shells)
command -v hash >/dev/null 2>&1 && hash -r || true
printf "\033[1;36m%s\033[0m\n" "Shell command hash refreshed"

# Check if there is any orphan dependencies
nb_orphans="$(pacman -Qdtq 2>/dev/null || true)"
if [ -n "$nb_orphans" ]; then
  printf "\033[1;31m%s\033[0m\n%s\n" "Orphans found:" "$nb_orphans"
else
  printf "\033[1;36m%s\033[0m\n" "No orphans found"
fi
